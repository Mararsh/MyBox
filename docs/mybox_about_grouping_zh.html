<html>
    <head>
        <title>行分组</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>
    <body style="width: 900px; margin:0 auto;">
        <h1 align="center">行分组</h1>
        <h2>1 分组前后</h2>
        <ol>
            <li><p>在分组之前，可以先过滤数据行。即分组的对象是过滤后的数据行。</p></li>
            <li><p>为了利用数据库系统实现排序和统计，数据在分组前都被自动转换为临时数据库表。</p></li>
            <li><p>对于分组后的数据，可以设置排序条件和每组最多取值个数。</p></li>
        </ol>
        <h2>2 分组的作用</h2>
        <p>把数据行分组以后，可以：</p>
        <ol>
            <li><p>对源数据添加分组信息，即新增两列：组编号、组参数。</p></li>
            <li><p>按组将数据分割为多个文件。</p></li>
            <li><p>按组进行描述性统计。</p></li>
            <li><p>按组依序显示为动态的XY图/饼图/相比较图/自比较图/箱线图。</p></li>
        </ol>
        <h2>3 分组的方式</h2>
        <p>MyBox支持六种数据分组方式：</p>
        <table border="1" cellpadding="4" cellspacing="0">
            <thead>
                <tr>
                    <th>方式</th>
                    <th>参数</th>
                    <th>完全</th>
                    <th>不相交</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>等值分组</td>
                    <td>若干列名</td>
                    <td>是</td>
                    <td>是</td>
                </tr>
                <tr>
                    <td>值范围分组</td>
                    <td>一个列名 + 分割尺寸</td>
                    <td>是</td>
                    <td>是</td>
                </tr>
                <tr>
                    <td></td>
                    <td>一个列名 + 分割个数</td>
                    <td>是</td>
                    <td>是</td>
                </tr>
                <tr>
                    <td></td>
                    <td>一个列名 + "开始值-结束值"列表</td>
                    <td>可能</td>
                    <td>可能</td>
                </tr>
                <tr>
                    <td>时间分组</td>
                    <td>一个时间类型的列名 + 时间单位</td>
                    <td>是</td>
                    <td>是</td>
                </tr>
                <tr>
                    <td>表达式分组</td>
                    <td>一个行表达式</td>
                    <td>是</td>
                    <td>是</td>
                </tr>
                <tr>
                    <td>条件分组</td>
                    <td>若干行过滤表达式</td>
                    <td>可能</td>
                    <td>可能</td>
                </tr>
                <tr>
                    <td>行范围分组</td>
                    <td>分割尺寸</td>
                    <td>是</td>
                    <td>是</td>
                </tr>
                <tr>
                    <td></td>
                    <td>分割个数</td>
                    <td>是</td>
                    <td>是</td>
                </tr>
                <tr>
                    <td></td>
                    <td>"开始行号-结束行号"列表</td>
                    <td>可能</td>
                    <td>可能</td>
                </tr>
            </tbody>
        </table>
        <p>以下分别介绍它们。</p>
        <h2>4 等值分组</h2>
        <h3>4.1 分组方式</h3>
        <p>选择若干列，把这些列的值都相同的数据行分为同一组。</p>
        <h3>4.2 实现原理</h3>
        <ol>
            <li><p>把数据转换为临时数据库表</p></li>
            <li><p>读取每行数据，按列值分组。其效果类似于SQL语句"group by"。</p></li>
        </ol>
        <h3>4.3 分组的结果</h3>
        <ul>
            <li><p>完全：每个数据行都属于一组。</p></li>
            <li><p>不相交：每个数据行都只属于一组。</p></li>
        </ul>
        <h2>5 值范围分组</h2>
        <h3>5.1 分组方式</h3>
        <p>选择一列，按照它的值范围分割数据行。</p>
        <p>分割条件有三种选择：</p>
        <ul>
            <li><p>值间隔</p></li>
            <li><p>分割的个数</p></li>
            <li><p>"开始值-结束值"的列表</p></li>
        </ul>
        <h3>5.2 对于时间/纪元进行分割</h3>
        <p>当被分割的列为时间/纪元类型：</p>
        <ol>
            <li><p>列值被转换为毫秒数。</p></li>
            <li><p>可设置时间单位。</p></li>
            <li><p>设置"开始-结束"项时，应输入合法的时间格式。</p></li>
        </ol>
        <h3>5.3 编辑起止列表</h3>
        <ol>
            <li><p>在表格中增删改起止项。</p></li>
            <li><p>对起止项可设置是否包含"开始"值或"结束"值。</p></li>
        </ol>
        <h3>5.4 实现原理</h3>
        <ol>
            <li><p>把数据转换为临时数据库表。</p></li>
            <li><p>忽略所选列的类型，将它的数据解析为双精度数值。</p></li>
            <li><p>计算该列的最大值和最小值。</p></li>
            <li><p>计算各组的区间</p></li>
            <li><p>构造各组的查询语句，条件类似于"列 &gt;= 区间开始值 AND 列 &lt; 区间结束值"。</p></li>
        </ol>
        <h3>5.5 分组的结果</h3>
        <ul>
            <li><p>若按值间隔或分割个数，则：</p>
                <ul>
                    <li><p>完全：每个数据行都属于一组。</p></li>
                    <li><p>不相交：每个数据行都只属于一组。</p></li>
                </ul></li>
            <li><p>若按"开始值-结束值"的列表，则：</p>
                <ul>
                    <li><p>可能不完全：可能有的数据行不属于任何一组。</p></li>
                    <li><p>可能相交：可能有的数据行属于多个组。</p></li>
                </ul></li>
        </ul>
        <h2>6 时间分组</h2>
        <h3>6.1 分组方式</h3>
        <p>只有当数据包含时间类型的列时，才能采用这种分组方式：</p>
        <ol>
            <li><p>选择一个时间类型的列</p></li>
            <li><p>选择时间单位：世纪/年/月/日/时/分/秒。</p></li>
        </ol>
        <p>例如：</p>
        <ul>
            <li><p>时间单位为"世纪"时，则计算数据的世纪，取同世纪为同组。</p></li>
            <li><p>时间单位为"月"时，则同年和月的数据分为同组。</p></li>
            <li><p>时间单位为"时"时，则同年、月、日、和时的数据分为同组。</p></li>
            <li><p>时间单位为"秒"时，则同年、月、日、时、分、和秒的数据分为同组。</p></li>
        </ul>
        <h3>6.2 实现原理</h3>
        <ol>
            <li><p>把数据转换为临时数据库表</p></li>
            <li><p>对所选时间单位，同值则同组。</p></li>
        </ol>
        <h3>6.3 分组的结果</h3>
        <ul>
            <li><p>完全：每个数据行都属于一组。</p></li>
            <li><p>不相交：每个数据行都只属于一组。</p></li>
        </ul>
        <h2>7 表达式分组</h2>
        <h3>7.1 分组方式</h3>
        <p>定义行表达式，其值相同则同组。</p>
        <p>例如：</p>
        <ul>
            <li><p>表达式"new Date(‘#{开始时间}’).getDay()"，按照列"开始时间"的星期值进行分组</p></li>
            <li><p>表达式"‘#{说明}’.charAt(2)"，按照列"说明"的第二个字符进行分组。</p></li>
            <li><p>表达式"‘#{开始时间}’.substring(0, 7)"，按照列"开始时间"的前7个字符进行分组。</p></li>
        </ul>
        <h3>7.2 实现原理</h3>
        <ol>
            <li><p>把数据转换为临时数据库表</p></li>
            <li><p>对每行数据计算表达式的值，同值则同组。</p></li>
        </ol>
        <h3>7.3 分组的结果</h3>
        <ul>
            <li><p>完全：每个数据行都属于一组。</p></li>
            <li><p>不相交：每个数据行都只属于一组。</p></li>
        </ul>
        <h2>8 条件分组</h2>
        <h3>8.1 分组方式</h3>
        <p>定义若干行过滤器，按照这些行过滤器将数据行分割成组。</p>
        <h3>8.2 实现原理</h3>
        <ol>
            <li><p>把数据转换为临时数据库表。</p></li>
            <li><p>对于每个行过滤器，遍历数据行以挑出满足条件的组成员。</p></li>
        </ol>
        <h3>8.3 分组结果</h3>
        <ul>
            <li><p>可能不完全：可能有的数据行不属于任何一组。</p></li>
            <li><p>可能相交：可能有的数据行属于多个组。</p></li>
        </ul>
        <h2>9 行号分组</h2>
        <h3>9.1 分组方式</h3>
        <p>按照数据行号分割数据行。有三种选择：</p>
        <ul>
            <li><p>分割的尺寸（数据行号间隔）</p></li>
            <li><p>分割的个数</p></li>
            <li><p>"开始行号-结束行号"的列表</p></li>
        </ul>
        <h3>9.2 实现原理</h3>
        <ol>
            <li><p>把数据转换为临时数据库表。</p></li>
            <li><p>计算各组的行号区间</p></li>
            <li><p>遍历数据行，按行号指定组。</p></li>
        </ol>
        <h3>9.3 分组的结果</h3>
        <ul>
            <li><p>若按分割尺寸或分割个数，则：</p>
                <ul>
                    <li><p>完全：每个数据行都属于一组。</p></li>
                    <li><p>不相交：每个数据行都只属于一组。</p></li>
                </ul></li>
            <li><p>若按"开始行号-结束行号"的列表，则：</p>
                <ul>
                    <li><p>可能不完全：可能有的数据行不属于任何一组。</p></li>
                    <li><p>可能相交：可能有的数据行属于多个组。</p></li>
                </ul></li>
        </ul>
    </body>
</html>