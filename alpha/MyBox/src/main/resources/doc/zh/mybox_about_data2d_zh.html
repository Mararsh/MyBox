<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <title>二维存储结构的数据</title>
    </head>
    <body style="width: 900px; margin:0 auto;" contenteditable="false">
        <h1 align="center">二维存储结构的数据</h1>
        <h2>1 数据对象</h2>
        <h3>1.1 外部形式</h3>
        <p>以下对象可以以一致的方式来编辑和计算：</p>
        <ul>
            <li>数据文件，包括：CSV文件、Excel文件、文本文件</li>
            <li>MyBox粘贴板的数据</li>
            <li>矩阵</li>
            <li>数据库表</li>
        </ul>
        <h3>1.2 存储结构</h3>
        <p>数据被表示为二维存储结构：</p>
        <ul>
            <li>“列”定义数据的属性/字段, 横向延展数据的维度。</li>
            <li>“行”保存数据的实例，纵向延展数据的集合。</li>
            <li>数据应当等宽，即所有行的列数都相同。</li>
        </ul>

        <h2>2 创建数据</h2>
        <p>可以用以下方式之一来创建新数据：</p>
        <ul>
            <li>点击或悬停按钮“创建数据”，选择数据的类型：CSV、Excel、文本、MyBox粘贴板、矩阵、数据库表。</li>
            <li>点击按钮“加载系统粘贴板中的数据”，选择行列。</li>
            <li>点击或悬停按钮“示例”，选择示例数据。可选“只导入定义”。</li>
        </ul>

        <h2>3 打开数据</h2>
        <p>可以用以下方式之一来打开已存在的数据：</p>
        <ul>
            <li>点击或悬停按钮“选择文件”，以加载外部文件的数据。</li>
            <li>点击按钮“选择”（CTRL+T或ALT+T），以加载被MyBox管理的数据。</li>
        </ul>

        <h2>4 四种处理模式</h2>
        <h3>4.1 页数据的网页-只读</h3>
        <ul>
            <li>显示当前页的网页格式。</li>
            <li>数据只读不可修改。</li>
            <li>可查看数据的定义。</li>
        </ul>
        <h3>4.2 表格-编辑</h3>
        <ul>
            <li>显示当前页的表格。</li>
            <li>可修改数据。</li>
            <li>可修改数据的定义。</li>
        </ul>
        <p>除了文本文件，对于字符串类型的数据，支持编辑和保存多行：</p>
        <ul>
            <li>若值是单行的（不包含换行符）：点击数据单元时显示单行输入框，在值中写入"\n" 作为换行符、然后提交修改（回车或点击其它地方）。</li>
            <li>若值中包含换行符：点击数据单元时显示多行输入框，直接编辑多行文本。</li>
        </ul>
        <h3>4.3 CSV-编辑</h3>
        <ul>
            <li>显示当前页的CSV格式。</li>
            <li>可修改数据。</li>
            <li>可修改数据的定义。</li>
            <li>点击按钮“分隔符”，以重新读取数据并应用新的分隔符。此分隔符不影响源文件。</li>
            <li>若数值包含分隔符或换行符，则数值应被引号包围起来。</li>
        </ul>
        <h3>4.4 页数据的文本-只读</h3>
        <ul>
            <li>显示当前页的文本格式。</li>
            <li>数据只读不可修改。</li>
            <li>可查看数据的定义。</li>
            <li>点击按钮“分隔符”，以重新读取数据并应用新的分隔符。此分隔符不影响源文件。</li>
        </ul>

        <h2>5 定义数据</h2>
        <p>在模式“表格-编辑”或模式“CSV-编辑”下， 点击按钮或菜单“定义数据”。</p>

        <h3>5.1 数据列的管理界面</h3>
        <p>在“列”页签下，在表格中增/删/改数据的列：</p>
        <ol>
            <li>
                <p>列名不能为空也不能重复。</p></li>
            <li>
                <p>直接点击表格单元以编辑</p></li>
            <li>
                <p>也可以选择列并点击“编辑”按钮以弹出列的编辑窗。</p></li>
            <li>
                <p>可以重命名所有字段为序列号。</p></li>
            <li>
                <p>可以随机设置颜色。</p></li>
            <li>
                <p>可以调整列的顺序。</p></li>
            <li>
                <p>点击按钮“确定”以把列的修改应用于当前数据。</p></li>
            <li>
                <p>点击按钮“恢复”以丢弃修改并从当前数据读取列的定义。</p></li>
        </ol>

        <h3>5.2 列的类型</h3>
        <ol>
            <li value="1">
                <p>列的类型包括：字串、双精度、浮点、长整型、整型、短整型、布尔型、日期时间、日期、纪元、经度、纬度、枚举型、可编辑枚举型、色彩。</p></li>
            <li>
                <p>此属性用于数据的显示、编辑、计算、和保存。</p></li>
            <li>
                <p>通常应成对定义经度和纬度。</p></li>
        </ol>

        <h3>5.3 列的格式</h3>
        <ol>
            <li>
                <p>此属性主要用于显示，在编辑输入数值时不会自动应用格式、而是保持原始的输入。</p></li>
            <li>
                <p>在一些界面上，如“复制”或“导出”，可选“按照列的格式保存日期/时间/纪元和数字”。</p>
                <p></p></li>
        </ol>
        <h4>5.3.1 数字的格式</h4>
        <p>对于数字类型，可选：以千分组、以万分组、科学计数法、无格式。</p>
        <h4>5.3.2 日期时间/日期的格式</h4>
        <p>对于日期时间/日期类型，支持：MM/dd/yy、yy-MM-dd、毫秒、时区、T分隔、补全世纪。</p>
        <h4>5.3.3 纪元的格式</h4>
        <p>对于纪元类型，支持：M/d/y、y-M-d、毫秒、时区、T分隔、补全世纪、中文前后缀（“公元”、“公元前”）、英文前后缀（“AD”、“BC”）。</p>
        <h4>5.3.4 定义枚举型</h4>
        <p>对于枚举型，可定义数值列表。</p>

        <h3>5.4 对于非法值的处理</h3>
        <ol>
            <li>
                <p>数据列对于非法值的处理策略：略过、计为空值、计为零。</p></li>
            <li>
                <p>在一些上下文环境中，“计为空值”等同于“略过”。</p></li>
            <li>
                <p>此属性只用于显示或者计算，在编辑输入数值时不会自动处理非法值。</p></li>
        </ol>

        <h3>5.5 列的颜色</h3>
        <p>列的颜色主要用于数据图。</p>
        <p>当数据图初始生成时，与列相关的图元素显示为列的颜色。其后用户可以设置为随机颜色。</p>

        <h3>5.6 数据的属性</h3>
        <p>在“属性”页签下，设置：数据名、小数位数、随机数的最大值、描述。</p>

        <h2>6 检验数据值</h2>
        <ol>
            <li value="1">
                <p>检验的对象可以是当前页中的数据行、也可以是全部数据。</p>
            </li>
        </ol>
        <ol start="2">
            <li>
                <p>以下内容被检验：</p>
                <ul>
                    <li>
                        <p>若列被定义为非空，则此列的空值为非法。</p></li>
                    <li>
                        <p>若数值不符合列的类型，则为非法。</p></li>
                </ul>
            </li>
        </ol>
        <ol start="3">
            <li>
                <p>选项：</p>
                <ul>
                    <li>
                        <p>编辑时检验数据。</p></li>
                    <li>
                        <p>保存时检验数据。</p></li>
                </ul>
            </li>
        </ol>

        <h2>7 编辑数据</h2>
        <p>列的应用原则为：“最大包容、最少处理”。</p>

        <h3>7.1 加载数据</h3>
        <p>加载数据时，不检查列类型，原样读取和导入。</p>

        <h3>7.2 显示数据</h3>
        <ol>
            <li>
                <p>若选择“编辑时检验数据”，则按列类型解析数值</p></li>
            <li>
                <p>按列的定义来处理非法值</p></li>
            <li>
                <p>按列的格式来重写数值</p></li>
            <li>
                <p>被显示的数值，可能与当前实际数值并不相同。</p></li>
            <li>
                <p>例如，列的类型为双精度，读入数值“abc”：</p></li>
        </ol>
        <ul>
            <ul>
                <li>
                    <p>若非法值计为零，则显示为零（实际值仍为“abc”）</p></li>
                <li>
                    <p>若非法值略过或计为空，则显示为“abc”。</p></li>
            </ul>
        </ul>

        <h3>7.3 编辑的控件</h3>
        <ol>
            <li>
                <p>对于布尔类型，显示选择框。</p></li>
            <li>
                <p>对于枚举类型，显示下拉选择列表。</p></li>
            <li>
                <p>对于颜色类型，显示调色盘。</p></li>
            <li>
                <p>对于经度/纬度，可在地图上选择位置。</p></li>
        </ol>

        <h3>7.4 编辑数据单元</h3>
        <ol>
            <li>
                <p>点击可编辑的数据单元，开始编辑。</p></li>
            <li>
                <p>开始编辑时，数值原样显示，忽略列类型和列格式。</p></li>
            <li>
                <p>在输入和修改数值过程中，按列类型检查输入框中的数值。</p></li>
        </ol>
        <ul>
            <ul>
                <li>
                    <p>若数值非法，则编辑框显示为异常颜色。</p></li>
                <li>
                    <p>若数值合法，则编辑框显示为正常颜色。</p></li>
                <li>
                    <p>数值始终保持用户的输入。</p></li>
            </ul>
        </ul>
        <ol start="4">
            <li>
                <p>按回车键以提交修改，按ESC键以取消修改。</p></li>
            <li>
                <p>选项：当焦点离开数据单元（点击其它控件）时，自动提交修改。</p></li>
            <li>
                <p>当修改被提交后，检查编辑框中的数值：</p></li>
        </ol>
        <ul>
            <ul>
                <li>
                    <p>若数值未变化，则不检查类型也不提交保存。</p></li>
                <li>
                    <p>若数值有变化，则按列类型检查修改后的数值：</p>
                    <ul>
                        <li>
                            <p>对非法值，拒绝保存，恢复数值、原样显示。</p></li>
                        <li>
                            <p>对合法值，提交保存，然后按列类型和列格式显示保存后的数值。</p></li>
                    </ul></li>
            </ul>
        </ul>
        <ol start="7">
            <li>
                <p>例如，列的类型为双精度，非法值计为空，小数位数为2。读入数值“abc”：</p></li>
        </ol>
        <ul>
            <ul>
                <li>
                    <p>数据单元显示为“abc”。</p></li>
                <li>
                    <p>用户修改它的数值为“abc123”：</p>
                    <ul>
                        <li>
                            <p>在用户输入过程中，输入框始终显示为异常颜色。</p></li>
                        <li>
                            <p>用户敲击回车或点击其它控件时，此数据单元恢复显示为“abc”并为正常颜色。</p></li>
                    </ul></li>
                <li>
                    <p>用户修改数值为“123.4567”：</p>
                    <ul>
                        <li>
                            <p>在用户输入过程中，输入框始终显示为正常颜色。</p></li>
                        <li>
                            <p>用户敲击回车或点击其它控件时，此数据单元被保存为“123.4567”、并显示为“123.46”。</p></li>
                    </ul></li>
            </ul>
        </ul>
        <ol start="8">
            <li>
                <p>其它数据单元不受影响。即只要不修改数据单元，它们就一直保持原样。</p></li>
        </ol>
        <ol start="9">
            <li>
                <p>选项：编辑时检验数据。即，不选此项时，编辑时不检查数据。</p></li>
        </ol>

        <h2>8 保存数据</h2>

        <h3>8.1 界面操作</h3>
        <ul>
            <li>点击按钮“保存”（CTRL+S或ALT+S）以把修改写入数据。</li>
            <li>行的变化，包括修改/添加/删除/排序，影响当前页的行。</li>
            <li>属性和列的变化，包括修改/添加/删除/排序，影响所有行。</li>
            <li>数据的定义（属性和列）被保存到内部数据库中。</li>
            <li>点击按钮“保存为”（F5或CTRL+B或ALT+B）以把数据写为其它格式：CSV、Excel、文本、MyBox粘贴板、矩阵、数据库表、系统粘贴板、JSON、XML、HTML、PDF。</li>
        </ul>

        <h3>8.2 保存数据文件</h3>
        <p>CSV/文本/Excel文件的数值都按字符串写入。 </p>
        <p>选项：保存时检验数据。即，不选此项时，保存时不检查数据。        </p>

        <h3>8.3 保存数据库表</h3>
        <p>对于数据库表的数值，总是检查类型和非空。</p>
        <p>数据库表的数按“就近类型”写入：</p>
        <table width="322" border="1"  cellpadding="4" cellspacing="0">
            <colgroup>
                <col width="146">
                <col width="158">
            </colgroup>
            <tbody>
                <tr valign="TOP">
                    <td width="146">
                        <p align="CENTER"><b>MyBox</b><b>的列类型</b></p></td>
                    <td width="158">
                        <p align="CENTER"><b>JDBC</b><b>的数据类型</b></p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>字串(String)</p></td>
                    <td width="158">
                        <p>VARCHAR</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>双精度(Double)</p></td>
                    <td width="158">
                        <p>DOUBLE</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>浮点(Float)</p></td>
                    <td width="158">
                        <p>FLOAT</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>长整型(Long)</p></td>
                    <td width="158">
                        <p>BIGINT</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>整型(Integer)</p></td>
                    <td width="158">
                        <p>INT</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>短整型(Short)</p></td>
                    <td width="158">
                        <p>SMALLINT</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>布尔型(Boolean)</p></td>
                    <td width="158">
                        <p>BOOLEAN</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>日期时间(Datetime)</p></td>
                    <td width="158">
                        <p>TIMESTAMP</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>日期(Date)</p></td>
                    <td width="158">
                        <p>DATE</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>纪元(Era)</p></td>
                    <td width="158">
                        <p>BIGINT</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>经度(Longitude)</p></td>
                    <td width="158">
                        <p>DOUBLE</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>纬度(Latitude)</p></td>
                    <td width="158">
                        <p>DOUBLE</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>枚举型(Enumeration)</p></td>
                    <td width="158">
                        <p>VARCHAR</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="146">
                        <p>颜色(Color)</p></td>
                    <td width="158">
                        <p>VARCHAR</p></td>
                </tr>
            </tbody>
        </table>
        <p>注： derby不支持负数的时间类型，所以只能用长整型保存纪元。</p>

        <h3>8.4 保存矩阵</h3>
        <p>对于矩阵的数值，总是检查类型和非空。</p>
        <p>所有数值都按双精度写入。</p>

        <h2>9 计算数据</h2>
        <ol>
            <li>
                <p>忽略列类型和列格式，用数据原值来处理，</p></li>
            <li>
                <p>按计算的要求解析数值。例如计算需要双精度数字，则试图将数值转换为双精度。</p></li>
            <li>
                <p>若数值转换失败，则按列的定义处理非法值。</p></li>
            <li>
                <p>计算本身也可以定义对非法值的处理策略。计算的定义优先于列的定义。</p></li>
            <li>
                <p>列和计算都可以定义小数位数。计算的定义优先于列的定义。</p></li>
            <li>
                <p>例如，列类型为字串，对它进行描述性统计：</p></li>
        </ol>
        <ul>
            <ul>
                <li>
                    <p>每个数值被试图转换为双精度</p></li>
                <li>
                    <p>若非法值计为零，则非法值也被算在“个数”里，同时参与平均值和总和的计算。</p></li>
                <li>
                    <p>若略过非法值，则非法值不参与任何计算。</p></li>
                <li>
                    <p>若非法值计为空，则非法值导致所有计算的结果都非法（Double.NaN）。</p></li>
            </ul>
        </ul>

        <h2>10 数据排序</h2>
        <ol>
            <li>
                <p>所有涉及到排序的计算，数据都会转换为临时数据库表，然后利用数据库系统来排序。</p></li>
            <li>
                <p>排序结果与列的类型有关。例如，字串“123”小于字串“18”，而数字“123”大于数字“18”。</p></li>
        </ol>

        <h2>11 管理数据</h2>
        <p>在内部数据表中记录数据对象的定义：</p>
        <table width="100%" border="1" cellpadding="4" cellspacing="0">
            <colgroup>
                <col width="57*">
                <col width="50*">
                <col width="46*">
                <col width="47*">
                <col width="56*">
            </colgroup>
            <tbody>
                <tr valign="TOP">
                    <td width="22%">
                        <p><br></p></td>
                    <td width="19%">
                        <p align="CENTER"><b>csv/excel/</b><b>文本</b></p></td>
                    <td width="18%">
                        <p align="CENTER"><b>MyBox</b><b>粘贴板</b></p></td>
                    <td width="18%">
                        <p align="CENTER"><b>矩阵</b></p></td>
                    <td width="22%">
                        <p align="CENTER"><b>数据库表</b></p></td>
                </tr>
                <tr valign="TOP">
                    <td width="22%">
                        <p><b>何时增加数据的定义</b></p></td>
                    <td width="19%">
                        <p>当数据文件第一次被打开时</p></td>
                    <td width="18%">
                        <p>当数据复制到MyBox粘贴板中</p></td>
                    <td width="18%">
                        <p>在矩阵管理器中保存新矩阵时</p></td>
                    <td width="22%">
                        <p>在数据库表管理器中保存新数据库表时</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="22%">
                        <p><b>数据的存储位置</b></p></td>
                    <td width="19%">
                        <p>数据文件</p></td>
                    <td width="18%">
                        <p>MyBox内部目录下的文件</p></td>
                    <td width="18%">
                        <p>MyBox数据库表</p></td>
                    <td width="22%">
                        <p>MyBox数据库表</p></td>
                </tr>
                <tr valign="TOP">
                    <td width="22%">
                        <p><b>当删除数据的定义</b></p></td>
                    <td width="19%">
                        <p>数据文件不受影响</p></td>
                    <td width="18%">
                        <p>删除内部文件</p></td>
                    <td width="18%">
                        <p>删除矩阵的数据</p></td>
                    <td width="22%">
                        <p>删除数据库表</p></td>
                </tr>
            </tbody>
        </table>

        <h2>12 数据文件</h2>
        <p>数据文件是外部数据，即：MyBox记录数据文件的定义、同时保持它的独立性。</p>
        <p>在MyBox读写数据文件之后，数据文件应当仍然可以被其它方式正常读写。</p>

        <h3>12.1  CSV文件</h3>
        <p>在CSV文件中：</p>
        <ul>
            <li>一般地，首行（头）定义列名，其余每行定义一行数据。</li>
            <li>值被"分隔符"分离。分隔符可以是字符串。</li>
            <li>若值包含分隔符或者换行，它应被引号围起来。</li>
            <li>若分隔符不是"#"，则以"#"开头的行将被略过（当作注释）。</li>
        </ul>
        <p>MyBox处理CSV文件时：</p>
        <ul>
            <li>首次打开文件时，工具猜测它的分隔符和字符集。</li>
            <li>当文件读取异常时，使用菜单“文件 - 格式”、改变选项并点击按钮“确定”。</li>
            <li>数据可以保存为不同的字符集和换行符。</li>
        </ul>

        <h3>12.2  Excel文件</h3>
        <p>在Excel文件中：</p>
        <ul>
            <li>一般地，首行（头）定义列名，其余每行定义一行数据。</li>
        </ul>
        <p>MyBox处理Excel文件时：</p>
        <ul>
            <li>当文件读取异常时，使用菜单“文件-格式”、改变选项并点击按钮“确定”。</li>
            <li>使用菜单“文件 - 表单”：选择一个工作表单以处理、也可以添加/重命名/删除工作表单。</li>
            <li>数据可以只保存当前表单、或者保存全部表单。</li>
        </ul>
        <p>注意：工具只能处理Excel文件的基本数据。如果文件包含格式、风格、公式、或图，建议把修改保存为新文件以免数据丢失。</p>

        <h3>12.3  文本文件</h3>
        <p>在文本文件中：</p>
        <ul>
            <li>一般地，首行（头）定义列名，其余每行定义一行数据。</li>
            <li>值被"分隔符"分离。分隔符可以是字符串。解析文件时支持规则表达式。</li>
            <li>值不能包含分隔符和换行符。</li>
            <li>若行以"#"开头，则它将被略过。</li>
        </ul>
        <p>MyBox处理文本文件时：</p>
        <ul>
            <li>首次打开文件时，工具猜测它的分隔符和字符集。</li>
            <li>当文件读取异常时，使用菜单“文件 - 格式”、改变选项并点击按钮“确定”。</li>
            <li>不支持数据值多行。</li>
            <li>数据可以保存为不同的字符集和换行符。</li>
        </ul>

        <hr>
        <p>更详细的说明见<a href="https://mara-mybox.sourceforge.io/guide/MyBox-DataTools-zh.pdf">《用户手册-数据工具》</a></p>
        <br>
    </body>
</html>